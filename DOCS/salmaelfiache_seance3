Objectif de la séance
L’objectif initial de cette séance était de terminer le schéma de câblage global du système. Cependant, le travail n’a pas pu être finalisé car le choix des broches de connexion (pins) n’était pas encore arrêté par le reste du groupe. J’ai donc décidé de me concentrer sur la compréhension et la programmation du module horloge DS3231M, afin de préparer son intégration future dans le système.
1. Introduction sur l’horloge DS3231M
Le DS3231M est un circuit intégré de type RTC (Real Time Clock), ou horloge temps réel, développé par Maxim Integrated. Il permet de conserver la date et l’heure avec une grande précision, même lorsque le microcontrôleur principal (ici l’ESP32) est éteint ou en mode veille.
Son fonctionnement repose sur :
Un oscillateur interne à quartz de 32,768 kHz, compensé en température, ce qui lui confère une très grande stabilité (±2 ppm, soit environ ±1 minute/an).
Une pile bouton CR2032 qui maintient l’alimentation de l’horloge lorsque le reste du circuit est hors tension.
Une communication via le bus I²C, utilisant seulement deux lignes : SDA (données) et SCL (horloge).
Le DS3231M gère automatiquement :
les secondes, minutes, heures, jours, mois et années,
les années bissextiles,
et propose une sortie SQW/INT permettant de générer une interruption périodique ou un réveil du microcontrôleur à une heure donnée.
Grâce à ces caractéristiques, il est idéal pour les systèmes autonomes comme notre arrosage automatique, où il faut exécuter des actions à des horaires précis tout en minimisant la consommation d’énergie.
2. Intégration prévue dans le projet
Dans notre système, le DS3231M sera utilisé pour :
Programmer les heures d’arrosage (ex. tous les matins à 7h et soirs à 19h),
Conserver l’heure exacte même en cas de coupure d’alimentation,
Réveiller l’ESP32 (via la broche SQW/INT) afin d’exécuter les cycles d’arrosage automatiquement.
Les broches SDA et SCL du DS3231M sont reliées respectivement aux broches GPIO 21 et GPIO 22 de l’ESP32. L’alimentation du module se fait en 3,3 V, et la masse est commune au reste du système.
3. Travail réalisé pendant la séance
Étude technique du composant DS3231M :
Lecture de la documentation et compréhension de son fonctionnement interne.
Analyse du protocole I²C et des registres de stockage de la date et de l’heure.
Étude de la précision du quartz et du rôle de la compensation en température.
Rédaction et test du code de communication ESP32 ↔ DS3231M :
Utilisation des bibliothèques Wire.h et RTClib.h.
Initialisation du bus I²C sur les broches 21 (SDA) et 22 (SCL).
Détection automatique du module RTC et initialisation de l’heure en cas de perte de la pile.
Lecture et affichage en continu de la date et de l’heure sur le moniteur série
Le code:
#include <Wire.h>
#include <RTClib.h>

RTC_DS3231 rtc;

void setup() {
  Serial.begin(115200);
  Wire.begin(21, 22);  // SDA sur 21, SCL sur 22

  if (!rtc.begin()) {
    Serial.println("RTC non détecté !");
    while (1);
  }

  if (rtc.lostPower()) {
    Serial.println("RTC a perdu l'heure, initialisation...");
    rtc.adjust(DateTime(F(__DATE__), F(__TIME__)));  // règle l'heure à la date de compilation
  }

  Serial.println("RTC prêt !");
}

void loop() {
  DateTime now = rtc.now();
  Serial.printf("%02d/%02d/%04d %02d:%02d:%02d\n",
                now.day(), now.month(), now.year(),
                now.hour(), now.minute(), now.second());
  delay(1000);
}
5. Résultats obtenus
Le module DS3231M a été correctement détecté par l’ESP32.
L’initialisation automatique de l’heure fonctionne lorsque la pile est retirée ou vide.
L’horloge fournit une mesure stable et précise du temps, avec un affichage correct dans le moniteur série.
Le test a validé la compatibilité entre le DS3231M et l’ESP32, ainsi que le bon fonctionnement de la communication I²C
6. Conclusion et perspectives
Cette séance a permis de :
Comprendre en détail le fonctionnement du module DS3231M,
Mettre au point un programme de test complet,
Vérifier la fiabilité de la communication avec l’ESP32.
Lors de la prochaine séance, il est prévu de :
finaliser le schéma de câblage complet du système,
intégrer le module horloge dans la carte principale,
et tester la synchronisation des cycles d’arrosage en fonction de l’heure programmée.
